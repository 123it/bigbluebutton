<?xml version="1.0" encoding="utf-8"?>

<!--
BigBlueButton open source conferencing system - http://www.bigbluebutton.org

Copyright (c) 2010 BigBlueButton Inc. and by respective authors (see below).

BigBlueButton is free software; you can redistribute it and/or modify it under the 
terms of the GNU Lesser General Public License as published by the Free Software 
Foundation; either version 2.1 of the License, or (at your option) any later 
version. 

BigBlueButton is distributed in the hope that it will be useful, but WITHOUT ANY 
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License along 
with BigBlueButton; if not, see <http://www.gnu.org/licenses/>.

$Id: $
-->

<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" 
				xmlns:mate="http://mate.asfusion.com/"
				title="Select Sip Phone"
				x="168" y="86" layout="absolute" initialize="init()"
				showCloseButton="true"
				>
	<mx:Script>
		<![CDATA[
			import com.asfusion.mate.events.Dispatcher;
			
			import mx.controls.Alert;
			
			import org.bigbluebutton.common.LogUtil;
			import org.bigbluebutton.modules.phone.events.JoinVoiceConferenceEvent;
			import org.bigbluebutton.modules.phone.events.cPHONE_JoinVoiceBySIPAppletEvent;
			
			private var dispatcher:Dispatcher = new Dispatcher();
			
			/*
			import flash.desktop.Clipboard;
			import flash.desktop.ClipboardFormats;
			import flash.desktop.ClipboardTransferMode;
			
			private function init():void{
				lblLink.htmlText		= "<a href='BigBlueButton Sip Phone.zip'><u>click here</u></a>";
				lblCopyDomain.htmlText 	= "<u><a href='#'>copy</a></u>";
				lblCopyRoom.htmlText 	= "<u><a href='#'>copy</a></u>";
				lblLaunchApplet.htmlText= "3. Launch <a href='#'><u>BBB SIP Applet</u></a>";
			}
			
			private function handleDisplayConfInfo(event:cPHONE_JoinVoiceConfInfoEvent):void{
				centerWindow();
				lblDomain.text 	= event.domainName;
				lblRoom.text	= event.voiceConfId;
			}
			
			private function centerWindow() : void {
				this.x = (this.parent.width - this.width) / 2;
				this.y = (this.parent.height - this.height) / 2;
			}
			
			private function copyToClipboard(text:String) : void {
				if (null == text){
					LogUtil.error("The parameter text for copy to clipboard is null");
					return;
				}
				Clipboard.generalClipboard.clear();
				Clipboard.generalClipboard.setData(ClipboardFormats.TEXT_FORMAT,text);	
			}
			
			private function onLinkClick() : void{
				var url:URLRequest = new URLRequest("http://" + lblDomain.text+"/client/BigBlueButton Sip Phone.zip");
				navigateToURL(url, '_blank');
			}
			
			private function onLaunchApplet() : void {
				if (true == ExternalInterface.available) 
				{
					// call external javascript 'handleNewUser'
					ExternalInterface.call("startSIPApplet", "admin");
				}
			}
			*/
			public function centerWindow() : void {
				this.x = (this.parent.width - this.width) / 2;
				this.y = (this.parent.height - this.height) / 2;
			}
			
			private function startSipPhone(isUseSipApplet:Boolean) : void {
				closeWindow();
				if(false == isUseSipApplet){
					LogUtil.debug("Starting flash sip phone");
					var joinVoiceEvent:JoinVoiceConferenceEvent = new JoinVoiceConferenceEvent();
					dispatcher.dispatchEvent(joinVoiceEvent);
				}else{
					LogUtil.debug("Starting applet sip phone");
					var joinVoiceBySipAppletEvent:cPHONE_JoinVoiceBySIPAppletEvent = new cPHONE_JoinVoiceBySIPAppletEvent(
																cPHONE_JoinVoiceBySIPAppletEvent.JOIN_VIOCE_BY_SIP_APPLET);
					dispatcher.dispatchEvent(joinVoiceBySipAppletEvent);
				}
			}
			
			private function closeWindow() : void {
				LogUtil.debug("Closing sip selection window");
				var event:cPHONE_JoinVoiceBySIPAppletEvent;
			    event = new cPHONE_JoinVoiceBySIPAppletEvent(
													   cPHONE_JoinVoiceBySIPAppletEvent.CLOSE_POP_UP);
				
				dispatcher.dispatchEvent(event);
			}
			
			private function init():void{

			}
		]]>
		
	</mx:Script>
	<!--<mx:VBox width="100%" paddingLeft="20" paddingTop="20" paddingBottom="20" paddingRight="20">
		<mx:Label text="To join bigbluebutton voice conference:" width="100%"></mx:Label>
		<mx:HBox>
			<mx:Label text="1. Download 'BigBlueButton Sip Phone': "></mx:Label>
			<mx:Label id="lblLink" click="onLinkClick()"></mx:Label>
		</mx:HBox>
		<mx:Label text="2. Use information below:"></mx:Label>
		<mx:HBox>
			<mx:VBox>
				<mx:Label text="Domain:"></mx:Label>
				<mx:Label text="Room:"></mx:Label>
			</mx:VBox>
			<mx:VBox>
				<mx:Label id="lblDomain"></mx:Label>
				<mx:Label id="lblRoom"></mx:Label>
			</mx:VBox>
			<mx:VBox>
				<mx:Label id="lblCopyDomain" text="copy" toolTip="copy domain to clipboard" click="copyToClipboard(lblDomain.text)"></mx:Label>
				<mx:Label id="lblCopyRoom" text="copy" toolTip="copy room to clipboard" click="copyToClipboard(lblRoom.text)"></mx:Label>
			</mx:VBox>
		</mx:HBox>
		<mx:Spacer width="100%"></mx:Spacer>
		<mx:Label id="lblLaunchApplet" click="onLaunchApplet()"></mx:Label>
	</mx:VBox>
	-->
	<mx:HBox width="100%" paddingLeft="20" paddingTop="20" paddingBottom="20" paddingRight="20">
		<mx:Button label="use applet sip phone" click="startSipPhone(true)"></mx:Button>
		<mx:Button label="use flash sip phone" click="startSipPhone(false)"></mx:Button>
	</mx:HBox>
</mx:TitleWindow> 